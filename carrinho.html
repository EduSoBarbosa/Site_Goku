<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho de Compras - Loja Dragon Ball</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1>Seu Carrinho de Compras</h1>
    </header>

    <nav>
        <a href="index.html">Voltar para a Loja</a> |
        <a href="carrinho.html">Carrinho</a>
    </nav>

    <div class="container">
        <div id="carrinho-itens" class="carrinho-list">
        </div>

        <div id="carrinho-resumo">
            <h2 id="total-itens-titulo">Resumo do Pedido</h2>
            <p>Total de Itens: <span id="total-itens">0</span></p>
            <p>Subtotal: <span id="subtotal">R$ 0,00</span></p>
            <hr>
            <h3>Total a Pagar: <span id="total-pagar" style="font-weight: bold;">R$ 0,00</span></h3>

            <button id="finalizar-compra" class="btn-dbz" disabled>Finalizar Compra</button>
            <button id="limpar-carrinho" class="btn-dbz btn-secondary">Limpar Carrinho</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Loja Dragon Ball. Todos os direitos reservados.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            renderizarCarrinho();

            document.getElementById('limpar-carrinho').addEventListener('click', limparCarrinho);
            document.getElementById('finalizar-compra').addEventListener('click', () => {
                alert('Funcionalidade de Finalizar Compra ainda será implementada!');
            });
        });

        function getCarrinho() {
            const carrinhoJSON = localStorage.getItem('carrinhoDBZ');
            return carrinhoJSON ? JSON.parse(carrinhoJSON) : [];
        }

        function salvarCarrinho(carrinho) {
            localStorage.setItem('carrinhoDBZ', JSON.stringify(carrinho));
            renderizarCarrinho();
        }

        function removerItem(nomeProduto) {
            let carrinho = getCarrinho();
            carrinho = carrinho.filter(item => item.nome !== nomeProduto);
            salvarCarrinho(carrinho);
        }

        function ajustarQuantidade(nomeProduto, novaQuantidade) {
            let carrinho = getCarrinho();
            const item = carrinho.find(item => item.nome === nomeProduto);

            if (item) {
                item.quantidade = Math.max(1, parseInt(novaQuantidade));
            }
            salvarCarrinho(carrinho);
        }

        function limparCarrinho() {
            if (confirm('Tem certeza de que deseja remover todos os itens do carrinho?')) {
                localStorage.removeItem('carrinhoDBZ');
                renderizarCarrinho();
            }
        }

        function renderizarCarrinho() {
            const carrinho = getCarrinho();
            const containerItens = document.getElementById('carrinho-itens');
            containerItens.innerHTML = '';

            let subtotal = 0;
            let totalItens = 0;

            if (carrinho.length === 0) {
                containerItens.innerHTML = '<p>Seu carrinho está vazio. Adicione alguns itens na <a href="index.html">página inicial</a>!</p>';
                document.getElementById('finalizar-compra').disabled = true;
                document.getElementById('total-itens-titulo').textContent = 'Carrinho Vazio';
            } else {
                carrinho.forEach(item => {
                    const precoTotalItem = item.preco * item.quantidade;
                    subtotal += precoTotalItem;
                    totalItens += item.quantidade;

                    const itemHTML = document.createElement('div');
                    itemHTML.classList.add('carrinho-item');
                    itemHTML.innerHTML = `
                        <img src="${item.imagem}" alt="${item.nome}" style="width: 80px; height: 80px;">
                        <div class="detalhes">
                            <h4>${item.nome}</h4>
                            <p>Preço unitário: R$ ${item.preco.toFixed(2).replace('.', ',')}</p>
                        </div>
                        <div class="quantidade">
                            <label for="qtd-${item.nome}">Qtd:</label>
                            <input type="number" id="qtd-${item.nome}" value="${item.quantidade}" min="1" 
                                data-nome="${item.nome}"
                                onchange="ajustarQuantidade('${item.nome}', this.value)">
                        </div>
                        <div class="subtotal-item">
                            <p>Total: R$ ${precoTotalItem.toFixed(2).replace('.', ',')}</p>
                            <button class="btn-remover" data-nome="${item.nome}">Remover</button>
                        </div>
                    `;
                    containerItens.appendChild(itemHTML);
                });

                document.querySelectorAll('.btn-remover').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const nomeProduto = e.target.dataset.nome;
                        removerItem(nomeProduto);
                    });
                });

                document.getElementById('finalizar-compra').disabled = false;
                document.getElementById('total-itens-titulo').textContent = 'Resumo do Pedido';
            }

            document.getElementById('total-itens').textContent = totalItens;
            document.getElementById('subtotal').textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
            document.getElementById('total-pagar').textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
        }
    </script>

</body>

</html>